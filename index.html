<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ó–∞–∫–∞–∑ –î–µ–¥–∞ –ú–æ—Ä–æ–∑–∞</title>
    <style>
        body { font-family: Arial; max-width: 600px; margin: 50px auto; padding: 20px; }
        input, textarea, select { width: 100%; padding: 8px; margin: 10px 0; }
        button { background: #e74c3c; color: white; border: none; padding: 10px; cursor: pointer; }
        .error { color: red; margin: 10px 0; }
        .suggestions { background: #f0f8ff; padding: 10px; border-left: 4px solid #2196F3; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>üéÑ –ó–∞–∫–∞–∑ –î–µ–¥–∞ –ú–æ—Ä–æ–∑–∞ –∏ –°–Ω–µ–≥—É—Ä–æ—á–∫–∏</h1>
    <form id="orderForm">
        <select id="character" required>
            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–≥–æ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å</option>
            <option value="–î–µ–¥ –ú–æ—Ä–æ–∑">–î–µ–¥ –ú–æ—Ä–æ–∑</option>
            <option value="–°–Ω–µ–≥—É—Ä–æ—á–∫–∞">–°–Ω–µ–≥—É—Ä–æ—á–∫–∞</option>
            <option value="–î–µ–¥ –ú–æ—Ä–æ–∑ –∏ –°–Ω–µ–≥—É—Ä–æ—á–∫–∞">–î–µ–¥ –ú–æ—Ä–æ–∑ –∏ –°–Ω–µ–≥—É—Ä–æ—á–∫–∞</option>
        </select>

        <input type="text" id="date" placeholder="–î–∞—Ç–∞ –≤–∏–∑–∏—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 24 –¥–µ–∫–∞–±—Ä—è 2024)" required>
        <input type="text" id="time" placeholder="–í—Ä–µ–º—è (–Ω–∞–ø—Ä–∏–º–µ—Ä: 14:00, 15:00, 16:00)" required>

        <div id="error" class="error"></div>
        <div id="suggestions" class="suggestions" style="display:none;"></div>

        <input type="text" id="address" placeholder="–ê–¥—Ä–µ—Å" required>
        <input type="number" id="children_count" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ç–µ–π" min="1" required>
        <input type="text" id="child_name" placeholder="–ò–º—è —Ä–µ–±—ë–Ω–∫–∞" required>
        <input type="text" id="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω (+79991234567)" required>
        <textarea id="comments" placeholder="–ü–æ–∂–µ–ª–∞–Ω–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" rows="3"></textarea>

        <button type="submit">–ó–∞–∫–∞–∑–∞—Ç—å!</button>
    </form>

    <p><a href="/download" target="_blank">üì• –°–∫–∞—á–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤</a></p>

    <script>
        const form = document.getElementById('orderForm');
        const errorDiv = document.getElementById('error');
        const suggestionsDiv = document.getElementById('suggestions');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = {
                character: document.getElementById('character').value,
                date: document.getElementById('date').value,
                time: document.getElementById('time').value,
                address: document.getElementById('address').value,
                children_count: document.getElementById('children_count').value,
                child_name: document.getElementById('child_name').value,
                phone: document.getElementById('phone').value,
                comments: document.getElementById('comments').value
            };

            const res = await fetch('/api/order', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            if (res.ok) {
                alert('‚úÖ –ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç!');
                form.reset();
                errorDiv.style.display = 'none';
                suggestionsDiv.style.display = 'none';
            } else {
                const result = await res.json();
                errorDiv.style.display = 'block';
                errorDiv.textContent = result.error;

                if (result.available && result.available.length > 0) {
                    suggestionsDiv.style.display = 'block';
                    suggestionsDiv.innerHTML = '<strong>–î–æ—Å—Ç—É–ø–Ω—ã –¥—Ä—É–≥–∏–µ –¥–∞—Ç—ã:</strong><br>' +
                        result.available.map(d => `‚Ä¢ ${d}`).join('<br>');
                }
            }
        });

        document.getElementById('date').addEventListener('blur', checkAvailability);
        document.getElementById('time').addEventListener('blur', checkAvailability);

        async function checkAvailability() {
            const date = document.getElementById('date').value.trim();
            const time = document.getElementById('time').value.trim();
            if (!date || !time) return;

            const res = await fetch(`/api/check?date=${encodeURIComponent(date)}&time=${encodeURIComponent(time)}`);
            const result = await res.json();

            if (result.available === false) {
                errorDiv.style.display = 'block';
                errorDiv.textContent = '‚ùå –≠—Ç–æ –≤—Ä–µ–º—è –∑–∞–Ω—è—Ç–æ!';
                if (result.suggestions && result.suggestions.length > 0) {
                    suggestionsDiv.style.display = 'block';
                    suggestionsDiv.innerHTML = '<strong>–î–æ—Å—Ç—É–ø–Ω—ã –¥—Ä—É–≥–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:</strong><br>' +
                        result.suggestions.map(d => `‚Ä¢ ${d}`).join('<br>');
                }
            } else {
                errorDiv.style.display = 'none';
                suggestionsDiv.style.display = 'none';
            }
        }
    </script>
</body>
</html>